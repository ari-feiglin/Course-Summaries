\def\date{July, 2025}

\edef\uscorecat{\the\catcode`_}
\catcode`_=11\relax
\catcode`@=11\relax

\def\_centerline{\hfil\egroup}
\def\centerline{\hbox to\hsize\bgroup\hfil\bgroup\aftergroup\_centerline\let\@@}

\createcounter{eqn counter}[subsection]

\def\@eqcnt[#1]{%
    \_xp\xdef\csname #1\endcsname{\the\counter{eqn counter}}%
}

\def\eqcnt{%
    \eqno{(\the\counter{eqn counter)}}%
    \advancecounter{eqn counter}{1}%
    \@ifnextchar[ \@eqcnt \relax%
}

\createcounter{math counter}[subsection]

\def\curvewidth{1.5pt}
\def\curvebuffer{10pt}

\def\curremphcolor{black}
{\catcode`_=11
\gdef\emphcolor{\expanded{\noexpand\_setcolor{}{\curremphcolor}}\setfont{bf}}
}

\def\printmcount{\the\counter{section}.\the\counter{subsection}.\the\counter{math counter}}

\def\createmathbox#1#2#3#4#5{%
    \_xp\def\csname _b#1\endcsname[##1]{
        \mapkeys{%
            title={%
                name=_title,
                default=\novalue%
            },
            name={%
                name=_name,
                default=\novalue%
            }%
        }{##1}%
        \bppbox{#3}{#4}{#5}%
        {\globalsetters\advancecounter{math counter}{1}\localsetters}%
        \def\curremphcolor{#5}%
        \hbox to\hsize{%
            \emphcolor\printmcount{} #2%
            \unless\ifx\_title\novalue%
                \ (\_title)%
            \fi%
            \unless\ifx\_name\novalue%
                \_xp\anchor\_xp{\_name}%
                \_xp\xdef\csname math@\_name\endcsname{\printmcount}%
                \unless\ifx\_title\novalue%
                    \_xp\xdef\csname math@\_name\endcsname{\_title}%
                    \addthreedepth{\_title}{\_name}%
                \fi%
            \fi%
        \hfil}%
        \hrule height\z@\relax%
        \medskip%
    }%
    \_xp\edef\csname b#1\endcsname{\medskip\noexpand\_ifnextchar[ {\_xp\noexpand\csname _b#1\endcsname}{\_xp\noexpand\csname _b#1\endcsname[]}}%
    \_xp\def\csname e#1\endcsname{\eppbox\medskip}%
}

\def\bproof{%
    \blinedppbox{rgb{1 1 1}}{rgb{0 0 0}}{rgb{0 0 0}}
    \hbox to \hsize{\setfont{bf}Proof\hfil}
    \medskip
}
\let\eproof=\elinedppbox

\def\blankpp{%
    \blinedppbox{rgb{1 1 1}}{rgb{0 0 0}}{rgb{0 0 0}}
}
\let\eblankpp=\elinedppbox

\def\bnote{%
    \bppbox{rgb{1 1 .5}}{rgb{.5 .4 0}}{rgb{.5 .4 0}}
    \noindent{\setfont{bf}Note:} %
}
\let\enote=\eppbox

\def\__refmath#1{\gotoanchor{#1}{\csname math@#1\endcsname}}
\def\_refmath[#1]#2{\gotoanchor{#2}{#1 \csname math@#2\endcsname}}
\def\refmath{\_ifnextchar[ {\_refmath}{\__refmath}}
\catcode`_=8

\createmathbox{defn}{Definition}{rgb{1 .9 .9}}{rgb{1 .3 .3}}{rgb{.8 .1 .1}}
\createmathbox{prob}{Problem}{rgb{.9 1 .9}}{rgb{.1 .4 .1}}{rgb{.1 .5 .1}}
\createmathbox{thrm}{Theorem}{rgb{.9 .9 1}}{rgb{.3 .3 1}}{rgb{.1 .1 .8}}
\createmathbox{coro}{Corollary}{rgb{.9 .9 1}}{rgb{.3 .3 1}}{rgb{.1 .1 .8}}
\createmathbox{lemm}{Lemma}{rgb{1 .9 1}}{rgb{1 .3 1}}{rgb{.8 .1 .8}}
\createmathbox{prop}{Proposition}{rgb{1 .9 1}}{rgb{1 .3 1}}{rgb{.6 .1 .6}}
\createmathbox{prin}{Principle}{rgb{1 1 .5}}{rgb{.5 .3 0}}{rgb{.5 .3 0}}
\createmathbox{exam}{Example}{rgb{.9 1 .9}}{rgb{.3 .8 .3}}{rgb{.1 .65 .1}}
\createmathbox{exerc}{Exercise}{rgb{.9 1 .9}}{rgb{.3 .8 .3}}{rgb{.1 .65 .1}}

\def\qed{%
    \ifmmode \eqno\mathchar"404%
    \else%
        \hskip1cm\penalty0\null\nobreak\hfill$\mathchar"404$%
        \par\medskip%
    \fi%
}

\def\qqed{%
    \ifmmode \eqno\diamond%
    \else%
        \hskip1cm\penalty0\null\nobreak\hfill$\diamond$
        \par\medskip%
    \fi%
}

\catcode`_=\uscorecat\relax

\def\itemstyle#1{\bf#1}
\def\bitems#1{%
    \bgroup\par%
    \def\item##1{%
        \par\egroup\bgroup\medskip\setbox0=\hbox to#1{\itemstyle{##1}\hfil}%
        \advance\leftskip by \dimexpr\wd0+\enumindent\relax\noindent\kern-\wd0\box0%
    }%
    \def\mtext{%
        \par\egroup\medskip\bgroup%
    }
    \bgroup%
}
\def\eitems{\par\egroup\egroup\medskip}

\def\frac#1#2{{{#1}\over{#2}}}
\def\dfrac#1#2{{\displaystyle{{\displaystyle#1}\over{\displaystyle#2}}}}

\def\c#1{{\cal #1}}
\def\s#1{{\sf  #1}}
\def\b#1{{\bf  #1}}

\def\newmathtype#1#2#3#4{%
    \expandafter\def\csname @#1\endcsname##1[##2]{\begingroup\left#2 ##1 \;\middle#3\; ##2 \right#4\endgroup}%
    \expandafter\def\csname @@#1\endcsname##1{\begingroup\left#2 ##1\right#4\endgroup}%
    \expandafter\def\csname #1\endcsname##1{\@ifnextchar[ {\csname @#1\endcsname{##1}}{\csname @@#1\endcsname{##1}}}%
}

\newmathtype{set}\{\vert\}
\newmathtype{gen}<\vert>
\def\parens#1{\mathopen{}\mathclose{\left(#1\right)}}
\def\abs#1{\mathopen{}\mathclose{\left|#1\right|}}
\def\ccoloneqq{\mathrel{{\mathop:}{\mathop:}{=}}}
\def\U{\c U}
\def\V{\c V}
\def\bV{{\bf V}}

\def\implies{\mathrel{\longvarRightarrow}}
\def\interior#1{#1^{\circ}}

